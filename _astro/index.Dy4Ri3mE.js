function c(e,t,n){let s="",o="";if(Array.isArray(n))for(let r=0;r<n.length;r++){const a=e.replace(t.thumbnail,t[n[r]]);s+=`${a} ${n[r]}w, `}else{const r=Object.keys(n);for(let a=0;a<r.length;a++){const i=r[a],d=e.replace(t.thumbnail,t[i]);s+=`${d} ${r[a]}w, `,a<r.length-1&&(o+=`(max-width: ${n[i]}px) ${i}px, `)}o+="100vw"}return{genSrcset:s,genSizes:o}}function p(e){const t=parseFloat(getComputedStyle(document.documentElement).fontSize)*2,n=window.innerHeight-t,s=window.innerWidth-t;return window.innerWidth/window.innerHeight>e?{w:n*e+"px",h:n+"px"}:{w:s+"px",h:s*(1/e)+"px"}}var l,h={mounted({img:e,rect:t},n,s,o){return new Promise(r=>{s.style.cssText=`top:${t.y}px;left:${t.x}px;width:${e.offsetWidth}px;height:${e.offsetHeight}px;`;const a=()=>{n.classList.add("MP-viewer-open"),l=()=>{const{w:i,h:d}=p(e.naturalWidth/e.naturalHeight);s.style.setProperty("--enlarged-photo-w",i),s.style.setProperty("--enlarged-photo-h",d)},l(),window.addEventListener("resize",l),s.srcset=c(e.dataset.minsrc,o.formats,o.enlarged).genSrcset,r()};s.addEventListener("load",a,{once:!0}),s.srcset=e.dataset.srcset})},close(e,t){return new Promise(n=>{setTimeout(()=>{e.classList.remove("MP-viewer-close","MP-viewer-open"),t.removeAttribute("style"),window.removeEventListener("resize",l),n()},400),e.classList.add("MP-viewer-close")})},setupPhotos(e,t,n){const s=e.photolist[t.dataset.group?.split("-")[0]||"rest"];let o=0;for(let r=0;r<s.length;r++){const a=s[r];a.srcset=c(a.srcset,n.formats,n.enlarged).genSrcset,typeof t<"u"&&a.src==t.dataset.minsrc&&(o=r)}return{photos:s,index:o}}};function u(){const e={photo(o){o.addEventListener("load",()=>{o.srcset==""?(o.addEventListener("load",()=>o.classList.add("loaded"),{once:!0}),o.srcset=o.dataset.srcset):o.classList.add("loaded")},{once:!0}),o.srcset=o.dataset.srcset}};async function t(o,r){o.forEach(a=>{if(a.intersectionRatio<=0)return;const i=a.target,d=i.dataset.observerhandler;if(!d||!e[d]){console.error(`No handler for ${d}, available handlers: ${Object.keys(e).join(", ")}, DOM element:`,i);return}e[d](i),r.unobserve(i)})}const n=new IntersectionObserver(t,{rootMargin:"0px",threshold:.05});return{callback:t,observer:n,photolist:{},handlers:e}}var f={addHandler(e,{name:t,handler:n}){e.handlers[t]=n},removeHandler(e,t){delete e.handlers[t]},addPhoto(e,t){const[n,s]=t.group?.split("-")||["rest",void 0];e.photolist[n]||(e.photolist[n]=[]),e.photolist[n].map(o=>o.src).includes(t.src)||(typeof s<"u"?e.photolist[n][s]=t:e.photolist[n].push(t))}};function w(e,t,n){if(typeof google<"u"&&typeof google.maps<"u")return;const s=document.createElement("script");s.src=`https://maps.googleapis.com/maps/api/js?v=weekly&key=${e}&callback=initMap`,s.async=!0,window.initMap=()=>t(n),document.head.appendChild(s)}export{w as a,h as b,u as c,f as m};
