function l(e,t,s){let o="",n="";if(Array.isArray(s))for(let r=0;r<s.length;r++){const i=e.replace(t.thumbnail,t[s[r]]);o+=`${i} ${s[r]}w, `}else{const r=Object.keys(s);for(let i=0;i<r.length;i++){const c=r[i],a=e.replace(t.thumbnail,t[c]);o+=`${a} ${r[i]}w, `,i<r.length-1&&(n+=`(max-width: ${s[c]}px) ${c}px, `)}n+="100vw"}return{genSrcset:o,genSizes:n}}function h(e){const t=parseFloat(getComputedStyle(document.documentElement).fontSize)*2,s=window.innerHeight-t,o=window.innerWidth-t;return window.innerWidth/window.innerHeight>e?{w:s*e+"px",h:s+"px"}:{w:o+"px",h:o*(1/e)+"px"}}var d,p=class{con;img;config;constructor(e,t,s){this.img=e,this.con=t,this.config=s}mounted({img:e,rect:t}){return new Promise(s=>{this.img.style.cssText=`top:${t.y}px;left:${t.x}px;width:${e.offsetWidth}px;height:${e.offsetHeight}px;`;const o=()=>{this.con.classList.add("MP-viewer-open"),d=()=>{const{w:n,h:r}=h(e.naturalWidth/e.naturalHeight);this.img.style.setProperty("--enlarged-photo-w",n),this.img.style.setProperty("--enlarged-photo-h",r)},d(),window.addEventListener("resize",d),this.img.srcset=l(e.dataset.minsrc,this.config.formats,this.config.enlarged).genSrcset,s()};this.img.addEventListener("load",o,{once:!0}),this.img.srcset=e.dataset.srcset})}close(){return new Promise(e=>{setTimeout(()=>{this.con.classList.remove("MP-viewer-close","MP-viewer-open"),this.img.removeAttribute("style"),window.removeEventListener("resize",d),e()},400),this.con.classList.add("MP-viewer-close")})}setupImgs(e,t){const s=e.photolist[t.dataset.group?.split("-")[0]||"rest"];let o=0;for(let n=0;n<s.length;n++){const r=s[n];r.srcset=l(r.srcset,this.config.formats,this.config.enlarged).genSrcset,typeof t<"u"&&r.src==t.dataset.minsrc&&(o=n)}return{photos:s,index:o}}};function f(){const e={photo(n){n.addEventListener("load",()=>{n.srcset==""?(n.addEventListener("load",()=>n.classList.add("loaded"),{once:!0}),n.srcset=n.dataset.srcset):n.classList.add("loaded")},{once:!0}),n.srcset=n.dataset.srcset}};async function t(n,r){n.forEach(i=>{if(i.intersectionRatio<=0)return;const c=i.target,a=c.dataset.observerhandler;if(!a||!e[a]){console.error(`No handler for ${a}, available handlers: ${Object.keys(e).join(", ")}, DOM element:`,c);return}e[a](c),r.unobserve(c)})}const s=new IntersectionObserver(t,{rootMargin:"0px",threshold:.05});return{callback:t,observer:s,photolist:{},handlers:e}}var u={addHandler(e,{name:t,handler:s}){e.handlers[t]=s},removeHandler(e,t){delete e.handlers[t]},addPhoto(e,t){const[s,o]=t.group?.split("-")||["rest",void 0];e.photolist[s]||(e.photolist[s]=[]),e.photolist[s].map(n=>n.src).includes(t.src)||(typeof o<"u"?e.photolist[s][o]=t:e.photolist[s].push(t))}};function g(e,t,s){if(typeof google<"u"&&typeof google.maps<"u")return;const o=document.createElement("script");o.src=`https://maps.googleapis.com/maps/api/js?v=weekly&key=${e}&callback=initMap`,o.async=!0,window.initMap=()=>t(s),document.head.appendChild(o)}export{f as S,u as a,g as b,p as m};
