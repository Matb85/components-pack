function c(e,t,s){let o="",n="";if(Array.isArray(s))for(let r=0;r<s.length;r++){const a=e.replace(t.thumbnail,t[s[r]]);o+=`${a} ${s[r]}w, `}else{const r=Object.keys(s);for(let a=0;a<r.length;a++){const d=r[a],i=e.replace(t.thumbnail,t[d]);o+=`${i} ${r[a]}w, `,a<r.length-1&&(n+=`(max-width: ${s[d]}px) ${d}px, `)}n+="100vw"}return{genSrcset:o,genSizes:n}}function p(e){const t=parseFloat(getComputedStyle(document.documentElement).fontSize)*2,s=window.innerHeight-t,o=window.innerWidth-t;return window.innerWidth/window.innerHeight>e?{w:s*e+"px",h:s+"px"}:{w:o+"px",h:o*(1/e)+"px"}}var l,u={mounted({img:e,rect:t},s,o,n){return new Promise(r=>{o.style.cssText=`top:${t.y}px;left:${t.x}px;width:${e.offsetWidth}px;height:${e.offsetHeight}px;`;const a=()=>{s.classList.add("MP-viewer-open"),l=()=>{const{w:d,h:i}=p(e.naturalWidth/e.naturalHeight);o.style.setProperty("--enlarged-photo-w",d),o.style.setProperty("--enlarged-photo-h",i)},l(),window.addEventListener("resize",l),o.srcset=c(e.dataset.minsrc,n.formats,n.enlarged).genSrcset,r()};o.addEventListener("load",a,{once:!0}),o.srcset=e.dataset.srcset})},close(e,t){return new Promise(s=>{setTimeout(()=>{e.classList.remove("MP-viewer-close","MP-viewer-open"),t.removeAttribute("style"),window.removeEventListener("resize",l),s()},400),e.classList.add("MP-viewer-close")})},setupPhotos(e,t,s){const o=e.photolist[t.dataset.group?.split("-")[0]||"rest"];let n=0;for(let r=0;r<o.length;r++){const a=o[r];a.srcsetReady||(a.srcset=c(a.srcset,s.formats,s.enlarged).genSrcset,a.srcsetReady=!0),typeof t<"u"&&a.src==t.dataset.minsrc&&(n=r)}return{photos:o,index:n}}};function f(){const e={photo(n){n.addEventListener("load",()=>{n.srcset==""?(n.addEventListener("load",()=>n.classList.add("loaded"),{once:!0}),n.srcset=n.dataset.srcset):n.classList.add("loaded")},{once:!0}),n.srcset=n.dataset.srcset}};async function t(n,r){n.forEach(a=>{if(a.intersectionRatio<=0)return;const d=a.target,i=d.dataset.observerhandler;if(!i||!e[i]){console.error(`No handler for ${i}, available handlers: ${Object.keys(e).join(", ")}, DOM element:`,d);return}e[i](d),r.unobserve(d)})}const s=new IntersectionObserver(t,{rootMargin:"0px",threshold:.05});return{callback:t,observer:s,photolist:{},handlers:e}}var h={addHandler(e,{name:t,handler:s}){e.handlers[t]=s},removeHandler(e,t){delete e.handlers[t]},addPhoto(e,t){const[s,o]=t.group?.split("-")||["rest",void 0];e.photolist[s]||(e.photolist[s]=[]),e.photolist[s].map(n=>n.src).includes(t.src)||(typeof o<"u"?e.photolist[s][o]=t:e.photolist[s].push(t))}};function w(e,t,s,o){if(typeof google<"u"&&typeof google.maps<"u")return;const n=document.createElement("script");n.src=`https://maps.googleapis.com/maps/api/js?v=weekly&key=${e}&callback=initMap`,n.async=!0,window.initMap=()=>t(s),document.head.appendChild(n),h.addHandler(o,{name:"map",handler:()=>t(s)}),o.observer.observe(s)}export{h as a,f as c,u as m,w as s};
