function c(e,t,s){let n="",o="";if(Array.isArray(s))for(let r=0;r<s.length;r++){const a=e.replace(t.thumbnail,t[s[r]]);n+=`${a} ${s[r]}w, `}else{const r=Object.keys(s);for(let a=0;a<r.length;a++){const i=r[a],d=e.replace(t.thumbnail,t[i]);n+=`${d} ${r[a]}w, `,a<r.length-1&&(o+=`(max-width: ${s[i]}px) ${i}px, `)}o+="100vw"}return{genSrcset:n,genSizes:o}}function p(e){const t=parseFloat(getComputedStyle(document.documentElement).fontSize)*2,s=window.innerHeight-t,n=window.innerWidth-t;return window.innerWidth/window.innerHeight>e?{w:s*e+"px",h:s+"px"}:{w:n+"px",h:n*(1/e)+"px"}}var l,h={mounted({img:e,rect:t},s,n,o){return new Promise(r=>{n.style.cssText=`top:${t.y}px;left:${t.x}px;width:${e.offsetWidth}px;height:${e.offsetHeight}px;`;const a=()=>{s.classList.add("MP-viewer-open"),l=()=>{const{w:i,h:d}=p(e.naturalWidth/e.naturalHeight);n.style.setProperty("--enlarged-photo-w",i),n.style.setProperty("--enlarged-photo-h",d)},l(),window.addEventListener("resize",l),n.srcset=c(e.dataset.minsrc,o.formats,o.enlarged).genSrcset,r()};n.addEventListener("load",a,{once:!0}),n.srcset=e.dataset.srcset})},close(e,t){return new Promise(s=>{setTimeout(()=>{e.classList.remove("MP-viewer-close","MP-viewer-open"),t.removeAttribute("style"),window.removeEventListener("resize",l),s()},400),e.classList.add("MP-viewer-close")})},setupPhotos(e,t,s){const n=e.photolist[t.dataset.group?.split("-")[0]||"rest"];let o=0;for(let r=0;r<n.length;r++){const a=n[r];a.srcsetReady||(a.srcset=c(a.srcset,s.formats,s.enlarged).genSrcset,a.srcsetReady=!0),typeof t<"u"&&a.src==t.dataset.minsrc&&(o=r)}return{photos:n,index:o}}};function u(){const e={photo(o){o.addEventListener("load",()=>{o.srcset==""?(o.addEventListener("load",()=>o.classList.add("loaded"),{once:!0}),o.srcset=o.dataset.srcset):o.classList.add("loaded")},{once:!0}),o.srcset=o.dataset.srcset}};async function t(o,r){o.forEach(a=>{if(a.intersectionRatio<=0)return;const i=a.target,d=i.dataset.observerhandler;if(!d||!e[d]){console.error(`No handler for ${d}, available handlers: ${Object.keys(e).join(", ")}, DOM element:`,i);return}e[d](i),r.unobserve(i)})}const s=new IntersectionObserver(t,{rootMargin:"0px",threshold:.05});return{callback:t,observer:s,photolist:{},handlers:e}}var f={addHandler(e,{name:t,handler:s}){e.handlers[t]=s},removeHandler(e,t){delete e.handlers[t]},addPhoto(e,t){const[s,n]=t.group?.split("-")||["rest",void 0];e.photolist[s]||(e.photolist[s]=[]),e.photolist[s].map(o=>o.src).includes(t.src)||(typeof n<"u"?e.photolist[s][n]=t:e.photolist[s].push(t))}};function w(e,t,s){if(typeof google<"u"&&typeof google.maps<"u")return;const n=document.createElement("script");n.src=`https://maps.googleapis.com/maps/api/js?v=weekly&key=${e}&callback=initMap`,n.async=!0,window.initMap=()=>t(s),document.head.appendChild(n)}export{w as a,h as b,u as c,f as m};
